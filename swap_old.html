<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
  <meta charset="utf-8">
  <title>Holder</title>
  <meta name="description" content="">
  <meta name="author" content="Cottage Labs">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script type="text/javascript" src="lib/jquery-1.10.2.min.js"></script>
  <script type="text/javascript" src="lib/bootstrap-3.0.3/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="lib/bootstrap-3.0.3/css/bootstrap.min.css">
  <script type="text/javascript" src="lib/d3/d3.min.js"></script>

  <script type="text/javascript" src="jquery.holder.js"></script>

  <script src="lib/d3/topojson.v1.min.js"></script>
  <script type="text/javascript" src="views/scotland.js"></script>

  <style>
    body {
      color:#666;
    }
    .label-swap {
      background-color:#ddd;
      color:#666;
      padding:3px 6px 3px 6px;
    }
    
    .subunit { fill: #ddd; }
    .subunit-boundary {
      fill: none;
      stroke:#66bbff;
      stroke-width:0.3px;
      stroke-dasharray: 2,2;
      stroke-linejoin: round;
    }
    .subunit-label {
      fill: #333;
      fill-opacity: .5;
      font-size: 2px;
      font-weight: 300;
      text-anchor: middle;
    }
    .school-label {
      fill: #333;
      fill-opacity: .5;
      font-size: 0.1px;
      font-weight: 300;
      text-anchor: middle;
    }
    svg .school{
        fill: none;
        stroke:#549bf6;
        stroke-width: 0.1px;
        cursor: pointer;
    }
  </style>
</head>

<body>
  
  <div class="container-fluid" style="width:1000px;margin:0 auto 50px auto;">
    
    <div class="row">
      <div class="col-md-12">
        <div class="jumbotron" style="background-color:#66bbff;">
          <h1 style="color:white;font-size:54px;text-align:center;">Scottish Wider Access Programme</h1>
          <p style="color:#444;font-size:20px;padding-top:10px;">A SWAP Access Programme can lead to a place on 
            an HN or degree course at college or university. Every year we help thousands of students gain access 
            to higher education. This report details how we've done.
          </p>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-12">
        <div class="well">
          <div class="row">
            <div class="col-md-6">
              <div class="row">
                <div class="col-md-6">
                  <h4>Select report period</h4>
                  <div id="listarchive"></div>            
                </div>
                <div class="col-md-6">
                  <h4>Select report locale</h4>
                  <div id="listlocale"></div>            
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <h4>Selected filters</h4>
              <input type="text" class="form-control holder holder-search holder-function" holder-function="add" placeholder="search..." style="font-size:1.6em;height:50px;margin-bottom:-6px;display:none;">
              <div class="holder holder-filters" style="margin-top:5px;"></div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <p>
                Begin customising the report by choosing a reporting period and locale above. 
                Further filters can be selected from the complete figures listings at the bottom of the report. 
                Selected filters will appear above, and can be deselected by clicking the <b>X</b> next to them.
              </p>
              <p>
                Print this report - option coming soon. Will print this report page, apart from this configuration box, 
                to a neat PDF report.
              </p>                  
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <h2 id="overview">
          
        </h2>
        <h2>
          <span id="period">Across all periods</span> <span id="inlocale">there were</span> <span class="label label-swap" id="total"></span> student registrations.
        </h2>
        <h2>
          * <span class="label label-swap" id="males"></span> were male, and 
          <span class="label label-swap" id="females"></span> were female.
        </h2>
        <h2>
          * Most were <span class="label label-swap" id="situation"></span>, 
          <span class="label label-swap" id="nationality"></span>,
          staying in <span class="label label-swap" id="post_code"></span>.
        </h2>
        <h2>
          * <span class="label label-swap" id="disability"></span> listed some form of disability, with 
          <span class="label label-swap" id="regd_disabled"></span> registered disabled.
        </h2>
        <h2>
          * The most popular course was <span class="label label-swap" id="pcourse"></span>  
          with <span class="label label-swap" id="pcoursen"></span> students.
        </h2>
        <h2>
          * The most common college was <span class="label label-swap" id="pcollege"></span>  
          with <span class="label label-swap" id="pcollegen"></span> students.
        </h2>
      </div>
    </div>

    <div class="row" style="margin-top:20px;">
      <div class="col-md-6" id="mapinfo">
        <div class="well" style="height:600px;">
          <p>
            TODO: The map currently does not show anything - it is work in progress. Once complete 
            it will show the relevant values based on the reporting options selected, showing counts 
            of registrants per post code area, the colleges they attend(ed), and how many attend(ed) each college.
          </p>
          <p>
            TODO: the report currently does not include any progression stats, but those will be added. 
            At that point map can also probably show (count of) registrants going to certain colleges, then 
            (count of) registrants going on to certain HE courses. NOTE: many progressions are to institutions 
            outside Scotland, but inside UK - so should map be of UK rather than just Scotland?
          </p>
          <p>
            TODO: should this report page be available and customisable to those outside of SWAP? Should static versions 
            of it be capable of being made available by choice by SWAP staff? Or should this report page only be 
            available to SWAP staff e.g. via the admin interface? (For now the page is public but only shows data if the 
            person viewing it is already logged in to the SWAP admin area - otherwise it will fail to load data.)
          </p>
        </div>
      </div>
      <div class="col-md-6" id="scotland" style="outline:1px solid #66bbff;height:600px;width:515px;padding:0;">
      </div>
    </div>

    <div class="row" style="margin-top:20px;">
      <div class="col-md-6" style="background-color:#eee;">
        <h4>Courses</h4>
        <div id="listcourse"></div>
      </div>
      <div class="col-md-3">
        <h4>Colleges</h4>
        <div id="listcollege"></div>
      </div>
      <div class="col-md-3" style="background-color:#eee;">
        <h4>College campuses</h4>
        <div id="listcampus"></div>
      </div>
    </div>

    <div class="row" style="margin-top:20px;">
      <div class="col-md-5" style="background-color:#eee;">
        <h4>Disabilities</h4>
        <div id="listdisability"></div>
      </div>
      <div class="col-md-2">
        <h4>Nationalities</h4>
        <div id="listnationality"></div>
      </div>
      <div class="col-md-2" style="background-color:#eee;">
        <h4>SIMD decile</h4>
        <div id="listsimd_decile"></div>
      </div>
      <div class="col-md-3">
        <h4>Registrant situations</h4>
        <div id="listsituation"></div>
      </div>
    </div>

  
  </div>

    
<script>
jQuery(document).ready(function() {
  
  scotland('#scotland');
  
  var results = function(data) {
    $('#total').text(data.hits.total);
    
    for ( var r in data.facets.disability.terms ) {
      if ( data.facets.disability.terms[r].term === "No known disability" ) {
        $('#disability').text(data.hits.total - data.facets.disability.terms[r].count - data.facets.disability.missing);
      }
    }

    for ( var r in data.facets.regd_disabled.terms ) {
      if ( data.facets.regd_disabled.terms[r].term === "true" ) {
        $('#regd_disabled').text(data.facets.regd_disabled.terms[r].count);
      }
    }

    try {
      $('#pcourse').text(data.facets.course.terms[0].term);
      $('#pcoursen').text(data.facets.course.terms[0].count);
    } catch(err) {}
    try {
      $('#pcollege').text(data.facets.college.terms[0].term);
      $('#pcollegen').text(data.facets.college.terms[0].count);
    } catch(err) {}

    try {
      $('#situation').text(data.facets.situation.terms[0].term + ' (' + data.facets.situation.terms[0].count + ')');
    } catch(err) {}
    try {
      $('#nationality').text(data.facets.nationality.terms[0].term + ' (' + data.facets.nationality.terms[0].count + ')');
    } catch(err) {}
    try {
      $('#post_code').text(data.facets.post_code.terms[0].term + ' (' + data.facets.post_code.terms[0].count + ')');
    } catch(err) {}

    if ( data.facets.archive.terms.length === 1 ) {
      $('#period').html('In the <span class="label label-swap">' +  data.facets.archive.terms[0].term + '</span> period');
    } else {
      $('#period').html('Across all periods');      
    }

    if ( data.facets.locale.terms.length === 1 ) {
      $('#inlocale').html('<span class="label label-swap">SWAP ' + data.facets.locale.terms[0].term + '</span> had');
    } else {
      $('#inlocale').html('there were');
    }

    for ( var r in data.facets.gender.terms ) {
      if ( data.facets.gender.terms[r].term === "Male" ) {
        $('#males').text(data.facets.gender.terms[r].count);
      }
      if ( data.facets.gender.terms[r].term === "Female" ) {
        $('#females').text(data.facets.gender.terms[r].count);
      }
    }
    
    $('#overview').html('');      
    try {
      var hasoverview = false;
      var overview = 'Report filtered for ';
      for ( var q in $('body').holder.options.query.query.filtered.filter.bool.must ) {
        var qq = $('body').holder.options.query.query.filtered.filter.bool.must[q].term;
        for ( var qqp in qq ) {
          if ( qqp !== 'archive.exact' && qqp !== 'locale.exact' ) {
            overview += '<span class="label label-swap">' + qqp.replace('.exact','').replace('_',' ') + ': ' + qq[qqp] + '</span> ';
            hasoverview = true;
          }
        }
      }
      if (hasoverview) $('#overview').html(overview + '.');
    } catch(err) {}

  }

  
  var facets = function(data) {
    var fcts = ['course','college','campus','disability','situation','nationality','archive','locale','simd_decile'];
    for ( var fct in fcts ) {
      var f =  fcts[fct];
      var disp = '<p>';
      for ( var r in data.facets[f].terms ) {
        var j = data.facets[f].terms[r];
        if ( j.term.length ) {
          disp += searchify({class: 'holder', val: j.term + ' (' + j.count + ')', attrs: {function: 'add', filter: f + '.exact', value: j.term} });
          disp += '<br>';
        }
      }
      disp += '</p>';
      $('#list' + f).html(disp);
    }
  }
  
  // get all where all four dependents categories are false

  // show simd decile and quintile tables
  
  // map by source post code or post code stub
  // map to college / progression location?
  // show movement from home to place of study?
  // show progression to where?
    
  $('body').holder({
    what: "SWAP report",
    url: "https://swapsurvey.org/query/student/_search",
    results: {
      default: results,
      facets: facets
    },
    size: 0,
    facets: {
      archive: { terms: { "field": "archive.exact", "size": 100, "order": "reverse_term" } },
      locale: { terms: { "field": "locale.exact" } },
      simd_decile: { terms: { "field": "simd_decile.exact" } },
      disability: { terms: { "field": "disability.exact", "size": 100 } },
      gender: { terms: { "field": "gender.exact" } },
      regd_disabled: { terms: { "field": "registered_disabled" } },
      situation: { terms: { "field": "situation.exact" } },
      nationality: { terms: { "field": "nationality.exact" } },
      college: { terms: { "field": "college.exact", "size": 100 } },
      campus: { terms: { "field": "campus.exact", "size": 100 } },
      course: { terms: { "field": "course.exact", "size": 100 } },
      post_code: { terms: { "field": "post_code", "size": 20 } }
    }
  }); 
    
});
</script>
        
    
</body>
</html>