<!DOCTYPE html>
<html dir="ltr" lang="en">

  <head>
    <meta charset="utf-8">
    <title>Holder | Sankey</title>
    <meta name="description" content="">
    <meta name="author" content="Cottage Labs">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script type="text/javascript" src="lib/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="lib/bootstrap-3.0.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="lib/bootstrap-3.0.3/css/bootstrap.min.css">

    <script type="text/javascript" src="jquery.holder.js"></script>

    <script src="lib/d3/d3.v3.min.js" charset="utf-8"></script>
    <script src="lib/d3/sankey.js"></script>
    <script src="views/sankey.js"></script>

    <style>
    #chart {
      height: 1000px;
    }
    .node rect {
      cursor: move;
      fill-opacity: .9;
      shape-rendering: crispEdges;
    }
    .node text {
      pointer-events: none;
      text-shadow: 0 1px 0 #fff;
    }
    .link {
      fill: none;
      stroke: #000;
      stroke-opacity: .2;
    }
    .link:hover {
      stroke-opacity: .5;
    }
    </style>
  </head>
    
  <body>

    <div class="row">
      <div class="col-md-12">
        <div id="chart"></div>    
      </div>
    </div>

    <script>
    jQuery(document).ready(function() {
      
      var results = function(data) {
        $('#chart').html("");
        sankey(data,'#chart');
      }
      
      $('body').holder({
        what: "SWAP report",
        url: "https://swapsurvey.org/query/student/_search",
        results: {
          default: results
        },
        pushstate:false,
        query: {
          "query": {
            "filtered": {
              "query": {
                "bool": {
                  "must": [
                  ]
                }
              },
              "filter": {
                "bool": {
                  "must":[
                    /*{
                      "query": {
                        "query_string": {
                          "query": "progressions.institution_shortname:*"
                        }
                      }
                    },*/
                    {
                      "query": {
                        "query_string": {
                          "query": "progressions.reg_2nd_year:*"
                        }
                      }
                    } //,
                    /*{
                      "term": {"archive.exact":"2013_2014"}
                    },*/
                    /*{
                      "term": {"locale.exact":"East"}
                    }*/
                  ]
                }
              }
            }
          },
          size: 1000,
          from:0,
          fields: ['classification','college','simd_quintile','progressions.institution_shortname','progressions.reg_2nd_year'] //,
        }
        //size: 1000,
        //from:0,
        //fields: ['classification','college','simd_quintile','progressions.institution_shortname'] //,
        /*facets: {
          simd_decile: { terms: { "field": "simd_decile.exact" } },
          college: { terms: { "field": "college.exact", "size": 100 } },
          course: { terms: { "field": "course.exact", "size": 100 } },
          post_code: { terms: { "field": "post_code", "size": 20 } }
        }*/
      }); 

    });
    </script>

  </body>
</html>